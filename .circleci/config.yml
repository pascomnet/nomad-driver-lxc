version: 2
jobs:
  build:
    docker:
      - image: circleci/golang:1.12
    steps:
      - checkout
      - run:
          name: info
          command: |
            whoami
      - run:
          name: prepare lxc
          command: |
            sudo -E bash ./scripts/travis-linux.sh
      - run:
          name: prepare go mod
          command: |
            make bootstrap
      - run:
          name: lint
          command: |
            make check
      - run:
          name: test
          command: |
            sudo -E "PATH=$PATH" GOTESTSUM_JUNITFILE=/tmp/results.xml make test
      - run:
          name: compile driver
          command: |
            make release
      - store_artifacts:
          path: pkg/linux_amd64.zip
          destination: linux_amd64.zip